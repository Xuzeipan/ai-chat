# Admin 端 Vue 3 重构规划方案

## 1. 技术栈选型

| 技术 | 选择 | 说明 |
|------|------|------|
| 框架 | Vue 3.4+ | 组合式 API + `<script setup>` 语法 |
| 语言 | TypeScript 5.x | 与 client 保持一致 |
| 构建工具 | Vite 5.x | 与 client 保持一致 |
| 状态管理 | Pinia | Vue 官方推荐，TypeScript 友好 |
| 路由 | Vue Router 4 | 支持动态路由、权限控制 |
| UI 组件库 | Element Plus | Admin 场景成熟，Vue 3 原生支持 |
| CSS | CSS Modules | 与 client 保持一致的风格 |
| HTTP 客户端 | axios | 后续与 server 端对接 |

## 2. 项目结构

```
apps/admin/
├── src/
│   ├── components/              # 通用组件
│   │   ├── Layout/              # 布局组件
│   │   │   ├── Layout.vue
│   │   │   ├── Sidebar.vue
│   │   │   ├── Header.vue
│   │   │   └── Layout.module.css
│   │   └── common/              # 业务通用组件
│   │       ├── DataTable/
│   │       ├── FormDialog/
│   │       └── SearchFilter/
│   ├── views/                   # 页面视图（按功能模块）
│   │   ├── Dashboard/           # 数据仪表盘
│   │   ├── UserManagement/      # 用户管理
│   │   ├── ChatHistory/         # 聊天记录管理
│   │   ├── Statistics/          # 数据统计
│   │   └── Settings/            # 系统设置
│   ├── router/                  # 路由配置
│   │   ├── index.ts             # 路由入口
│   │   └── routes.ts            # 路由表
│   ├── stores/                  # Pinia 状态管理
│   │   ├── index.ts             # store 入口
│   │   ├── user.ts              # 用户状态
│   │   ├── app.ts               # 应用状态（侧边栏、主题等）
│   │   └── chat.ts              # 聊天相关状态
│   ├── services/                # API 服务
│   │   ├── api.ts               # axios 实例配置
│   │   ├── user.ts              # 用户 API
│   │   ├── chat.ts              # 聊天 API
│   │   └── stats.ts             # 统计 API
│   ├── utils/                   # 工具函数
│   │   ├── request.ts           # 请求拦截器
│   │   ├── auth.ts              # 权限工具
│   │   └── format.ts            # 格式化工具
│   ├── types/                   # 类型定义
│   │   ├── user.ts              # 用户相关类型
│   │   ├── chat.ts              # 聊天相关类型
│   │   └── api.ts               # API 通用类型
│   ├── composables/             # 组合式函数（Vue 3 特色）
│   │   ├── useUser.ts           # 用户相关逻辑
│   │   ├── useTable.ts          # 表格通用逻辑
│   │   └── useChart.ts          # 图表通用逻辑
│   ├── App.vue                  # 根组件
│   ├── main.ts                  # 入口文件
│   └── env.d.ts                 # 环境类型声明
├── public/                      # 静态资源
├── index.html                   # HTML 模板
├── package.json                 # 包配置
├── vite.config.ts               # Vite 配置
├── tsconfig.json                # TypeScript 配置
└── tsconfig.app.json            # 应用 TS 配置
```

## 3. 文件内容规划

### 3.1 package.json
```json
{
  "name": "@ai-chat/admin",
  "version": "0.0.1",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vue-tsc --noEmit && vite build",
    "preview": "vite preview",
    "lint": "eslint . --ext .vue,.ts,.tsx"
  },
  "dependencies": {
    "vue": "^3.4.0",
    "vue-router": "^4.2.0",
    "pinia": "^2.1.0",
    "element-plus": "^2.5.0",
    "axios": "^1.6.0",
    "@element-plus/icons-vue": "^2.3.0"
  },
  "devDependencies": {
    "@vitejs/plugin-vue": "^5.0.0",
    "vue-tsc": "^1.8.0",
    "typescript": "~5.9.3",
    "vite": "^7.2.4"
  }
}
```

### 3.2 vite.config.ts
```typescript
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import { resolve } from 'path'

export default defineConfig({
  plugins: [vue()],
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src')
    }
  },
  server: {
    port: 5174,  // client 用 5173，admin 用 5174
    proxy: {
      '/api': {
        target: 'http://localhost:3000',
        changeOrigin: true
      }
    }
  }
})
```

### 3.3 tsconfig.json
```json
{
  "extends": "../../tsconfig.base.json",
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "module": "ESNext",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "preserve",
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["src/**/*.ts", "src/**/*.tsx", "src/**/*.vue"],
  "references": [{ "path": "./tsconfig.node.json" }]
}
```

## 4. 与现有架构的整合

### 4.1 根 package.json 脚本更新
```json
{
  "scripts": {
    "dev": "turbo dev",
    "build": "turbo build",
    "clean": "turbo clean && rm -rf node_modules",
    "client": "pnpm --filter @ai-chat/client",
    "admin": "pnpm --filter @ai-chat/admin",
    "server": "pnpm --filter @ai-chat/server"
  }
}
```

使用方式：
```bash
pnpm admin dev       # 启动 admin 开发服务器
pnpm admin build     # 构建 admin
pnpm admin lint      # 检查 admin 代码
```

### 4.2 turbo.json 任务配置
```json
{
  "pipeline": {
    "build": {
      "dependsOn": ["^build"],
      "outputs": ["dist/**"]
    },
    "dev": {
      "cache": false,
      "persistent": true
    },
    "clean": {
      "cache": false
    }
  }
}
```

### 4.3 共享包设计（packages/shared）

目前 shared 包为空，建议后续抽取：

```
packages/shared/
├── src/
│   ├── types/           # 共享类型
│   │   ├── chat.ts      # Message, ChatState 等
│   │   ├── user.ts      # User, UserRole 等
│   │   └── api.ts       # API 响应类型
│   ├── constants/       # 共享常量
│   │   └── modes.ts     # AI 模式配置
│   └── utils/           # 共享工具
│       └── format.ts    # 日期、文本格式化
├── package.json
└── tsconfig.json
```

**注意**：Vue 3 和 React 的共享类型需要保持框架无关，只定义纯数据类型。

## 5. 命名规范统一

| 场景 | Client (React) | Admin (Vue) |
|------|----------------|-------------|
| 组件 | PascalCase `.tsx` | PascalCase `.vue` |
| 样式 | `Component.module.css` | `Component.module.css` |
| Props 类型 | `ComponentNameProps` | `ComponentNameProps` |
| 事件 | `on` 前缀 | `on` 前缀（emit）|
| 状态 | `useState` | `ref` / `reactive` |
|  store  | - | `useXxxStore` |
| 组合式 | - | `useXxx` |

## 6. 开发端口分配

| 应用 | 端口 | 说明 |
|------|------|------|
| client | 5173 | 用户端 |
| admin | 5174 | 管理端 |
| server | 3000 | 服务端（后续）|

## 7. 实现步骤建议

### Phase 1: 基础搭建
1. 创建 admin 目录结构
2. 配置 package.json、vite.config.ts、tsconfig.json
3. 安装依赖
4. 验证 `pnpm admin dev` 能正常启动

### Phase 2: 核心功能
1. 布局组件（Sidebar、Header、Layout）
2. 路由配置（Vue Router）
3. 状态管理（Pinia）
4. Element Plus 集成

### Phase 3: 业务页面
1. Dashboard（数据概览）
2. UserManagement（用户列表、增删改查）
3. ChatHistory（聊天记录查看）
4. Statistics（数据统计图表）
5. Settings（系统设置）

### Phase 4: 与 Server 对接
1. axios 配置
2. API 服务层
3. 权限控制

## 8. 文件改动清单

### 新增文件
- `apps/admin/package.json`
- `apps/admin/vite.config.ts`
- `apps/admin/tsconfig.json`
- `apps/admin/tsconfig.node.json`
- `apps/admin/index.html`
- `apps/admin/src/main.ts`
- `apps/admin/src/App.vue`
- `apps/admin/src/router/index.ts`
- `apps/admin/src/stores/index.ts`
- `apps/admin/env.d.ts`

### 修改文件
- `README.md` - 更新技术栈和项目结构说明
- `CLAUDE.md` - 更新 admin 相关命令

## 9. 注意事项

1. **Element Plus 按需导入**：使用 `unplugin-vue-components` 和 `unplugin-auto-import` 自动导入组件
2. **TypeScript 严格模式**：与 client 保持一致
3. **CSS 变量共享**：考虑在 packages/ui 中定义共享 CSS 变量
4. **图标方案**：使用 `@element-plus/icons-vue`
5. **Mock 数据**：初期可用 mock 数据，等 server 端完成后再对接
